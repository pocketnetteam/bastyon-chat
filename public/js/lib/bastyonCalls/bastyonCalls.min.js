/*! For license information please see bastyonCalls.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.libraryStarter=e():t.libraryStarter=e()}(this,(()=>(()=>{"use strict";var t={326:(t,e,n)=>{n.d(e,{Z:()=>c});var i=n(81),r=n.n(i),o=n(645),a=n.n(o)()(r());a.push([t.id,'#bc-root.full{position:fixed !important;z-index:300000;width:100vw;height:100vh;top:0}#bc-root.full #bc-format i::before{content:""}#bc-root.middle{position:fixed !important;z-index:300000;width:100vw;height:100vh;top:0}#bc-root.middle .bc-format{display:none}@media screen and (min-width: 1280px){#bc-root.middle{z-index:300000;width:70vw;height:80vh;top:10vh}#bc-root.middle .bc-topnav{width:70vw}#bc-root.middle .bc-topnav .bc-format{display:initial}#bc-root.middle .bc-video-container{width:70vw;height:80vh;position:relative}#bc-root.middle .bc-video-container .active video{max-width:70vw;max-height:80vh}#bc-root.middle .bc-video-container .minified{position:absolute}#bc-root.middle .bc-controls{max-width:70vw;bottom:10vh;padding:2% 0}}#bc-root.middle #bc-format i::before{content:""}#bc-root.minified{position:fixed;width:auto;height:auto;top:initial;right:initial;bottom:20px;left:20px;border:1px solid rgba(0,0,0,0);border-radius:30px;overflow:hidden;cursor:pointer}#bc-root.minified .bc-topnav{opacity:0}#bc-root.minified .bc-topnav .bc-call-info{max-width:100%}#bc-root.minified .bc-topnav .options{display:none}#bc-root.minified .bc-video-container{width:auto;height:auto;max-height:initial !important;padding-bottom:0;transition:all .3s ease}#bc-root.minified .bc-video-container.vertical{max-width:250px}#bc-root.minified .bc-video-container.vertical .active{max-width:250px}#bc-root.minified .bc-video.minified{display:none}#bc-root.minified .bc-video.active{transition:all .3s ease;height:100%;max-width:350px}#bc-root.minified .bc-video.active.novid{max-height:250px;padding:1em;max-width:250px}#bc-root.minified .bc-video.active video{width:auto}@media screen and (max-width: 768px){#bc-root.minified .bc-video .name{display:none}}#bc-root.minified .bc-video-btn{display:none}#bc-root.minified .bc-controls{position:absolute;bottom:0;min-width:initial !important;justify-content:space-between;opacity:0;transition:opacity .3s ease}@media screen and (max-width: 1025px){#bc-root.minified .bc-controls{display:none !important}}#bc-root.minified .bc-controls .bc-btn{width:4vw;height:4vw;max-width:55px;max-height:55px;font-size:.8rem;margin:0}#bc-root.minified .bc-controls .bc-btn.bc-camera,#bc-root.minified .bc-controls .bc-btn.bc-hide{display:none}#bc-root.minified .bc-controls .bc-btn#bc-expand{display:flex}#bc-root.minified:hover .bc-controls,#bc-root.minified:hover .bc-topnav{display:flex;opacity:1}@media screen and (max-width: 1025px){#bc-root.minified{top:65px !important;right:10px !important;left:initial !important;bottom:initial !important;border-radius:15px;overflow:hidden}#bc-root.minified .bc-video-container{max-width:250px}#bc-root.minified .bc-video-container.vertical{max-width:25vw}#bc-root.minified .bc-topnav{display:none !important}}.bc{-webkit-tap-highlight-color:rgba(0,0,0,0) !important}.bc-container{font-family:"Segoe UI Variable","Segoe UI",SegoeUI,"Helvetica Neue",Helvetica,Arial,sans-serif;display:flex;flex-wrap:wrap;justify-content:space-evenly;align-items:center}.bc-container>div{z-index:333333}.bc-notify{z-index:4444444 !important;position:fixed;top:28px}.bc-incoming-call{z-index:33333;padding:10px;width:494px;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;background:radial-gradient(87.44% 183.75% at 50% 50%, rgba(0, 0, 0, 0) 0%, #000000 100%),#242f3d;box-shadow:0 4px 20px rgba(0,0,0,.5);border-radius:12px}@media screen and (max-width: 576px){.bc-incoming-call{padding:16px;width:90vw}}.bc-incoming-call .user{display:flex;justify-content:space-between;max-width:50%}@media screen and (max-width: 576px){.bc-incoming-call .user{max-width:70%;margin-bottom:16px}}.bc-incoming-call .user .title{text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;line-height:20px;color:rgb(var(--color-cc-white))}.bc-incoming-call .user .title .name{font-size:16px;text-align:left;color:rgb(var(--text-on-bg-ac-color));width:200px;overflow:hidden;text-overflow:ellipsis}.bc-incoming-call .user .title .description{color:rgb(var(--neutral-grad-2));font-size:14px;text-align:left}.bc-incoming-call .user .avatar{margin-right:16px;border:2px solid rgba(0,0,0,0);width:44px;height:44px;border-radius:50%;overflow:hidden;display:flex;justify-content:center;align-items:center;font-size:1.4em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-incoming-call .user .avatar img{height:100%;width:100%}.bc-incoming-call .buttons{display:flex;justify-content:space-between}@media screen and (max-width: 576px){.bc-incoming-call .buttons{width:100%;justify-content:space-between}.bc-incoming-call .buttons .bc-btn{width:48% !important;margin:0}}.bc-incoming-call .buttons .bc-btn{width:56px;height:48px;border-radius:12px;margin:0 10px;border:none;cursor:pointer}.bc-incoming-call .buttons .bc-answer{background:linear-gradient(90deg, #495AFF 0%, #0ACFFE 100%),#00a4ff}.bc-incoming-call .buttons .bc-answer i{transform:rotate(90deg)}.bc-incoming-call .buttons .bc-decline{background:linear-gradient(90deg, #EB3349 2.65%, #F45C43 100.53%),#eb5757}.bc-incoming-call .buttons .bc-decline i{transform:rotate(225deg)}.bc-incoming-call .buttons i{color:rgb(var(--text-on-bg-ac-color))}.bc-ended-call{width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;background:radial-gradient(87.44% 183.75% at 50% 50%, rgba(0, 0, 0, 0) 0%, #000000 100%),#242f3d;color:rgb(var(--text-on-bg-ac-color))}.bc-ended-call .avatar{display:flex;border:2px solid rgba(var(--background-hidden-layer, 0.1));width:160px;height:160px;border-radius:50%;overflow:hidden;justify-content:center;align-items:center;font-size:1.6em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-ended-call .avatar img{width:100%;height:100%}.bc-ended-call .name{font-size:28px;font-weight:600;margin-top:42px;width:400px;text-align:center;max-width:90vw;overflow:hidden;text-overflow:ellipsis}.bc-ended-call .description{color:#838383;font-size:16px;line-height:24px;margin-top:4px}.bc-ended-call button{cursor:pointer}.bc-video{position:relative;display:flex;justify-content:center}@media screen and (orientation: portrait){.bc-video{max-width:100%}}.bc-video-container{display:flex;justify-content:center;flex-wrap:wrap;align-items:center;width:100vw;height:100vh;background:radial-gradient(55.29% 79.17% at 50% 47.76%, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.88) 100%),#242f3d;box-shadow:0 32px 64px rgba(0,0,0,.56),0 2px 21px rgba(0,0,0,.55)}@media screen and (orientation: portrait){.bc-video{justify-content:center}}.bc-video .name{position:absolute;bottom:0;left:0;text-align:center;font-size:12px;height:12px;line-height:12px;min-width:60px;background-color:rgba(255,255,255,.4)}.bc-video video{max-height:100%;width:100%}@media screen and (orientation: portrait){.bc-video video{max-height:40vh}}.bc-video.active{width:100%;margin:0 auto;height:100vh;max-height:100vh}.bc-video.active .avatar{border:2px solid rgba(var(--background-hidden-layer, 0.1));width:160px;height:160px;border-radius:50%;overflow:hidden;display:none;justify-content:center;align-items:center;font-size:1.6em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-video.active .avatar img{width:100%;height:100%}.bc-video.active video{max-height:100vh;max-width:100vw;width:auto !important}.bc-video.active.novid{max-height:100%;align-items:center}.bc-video.active.novid .avatar{display:flex}.bc-video.active.novid video{display:none}.bc-video.minified{margin:0;border-radius:20px;border:2px solid #fff;z-index:33333333;position:fixed;right:30px;bottom:10%;overflow:hidden}.bc-video.minified video{transform:scale(-1, 1);height:15vh;width:auto;max-height:150px}@media screen and (orientation: portrait){.bc-video.minified video{height:15vh;width:auto}}.bc-controls{display:flex;justify-content:center;position:fixed;background:linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.99466) 99.44%);bottom:0;width:100%;padding:5%;min-width:280px !important;max-width:100vw}.bc-controls .bc-btn{margin:0 20px;background:rgba(var(--neutral-grad-2), 0.4);text-align:center;font-size:1em;font-weight:600;border-radius:50%;width:55px;height:55px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:none}.bc-controls .bc-btn.active{background:rgb(var(--text-on-bg-ac-color))}.bc-controls .bc-btn.active i{color:rgb(var(--text-color))}@media screen and (max-width: 768px){.bc-controls .bc-btn{margin:0 10px;width:45px;height:45px}}.bc-controls .bc-btn i{pointer-events:none;color:rgb(var(--text-on-bg-ac-color))}.bc-controls .bc-btn.bc-decline{background:rgb(var(--color-bad));border:1px solid rgba(0,0,0,0);transform:rotate(225deg)}.bc-controls .bc-btn#bc-expand{display:none}.bc-topnav{z-index:4444444 !important;display:flex;justify-content:space-between;align-items:center;position:absolute;top:0;right:0;left:0;color:rgb(var(--text-on-bg-ac-color));background:linear-gradient(180deg, rgba(0, 0, 0, 0.799466) 0%, rgba(0, 0, 0, 0) 99.44%);padding:26px 28px;width:100vw}.bc-topnav .options button{background:rgba(0,0,0,0);border:none;cursor:pointer}.bc-topnav .options button i{color:rgb(var(--text-on-bg-ac-color))}.bc-call-info{display:flex;align-items:center}.bc-call-info .avatar{display:flex;width:40px;height:40px;border-radius:50%;overflow:hidden;justify-content:center;align-items:center;font-size:1.6em;color:rgba(var(--background-hidden-layer, 0.1));background:rgb(var(--neutral-grad-0))}.bc-call-info .avatar img{height:100%}.bc-call-info .info{margin-left:10px;display:flex;flex-direction:column}.bc-call-info .info .name{font-weight:700;width:200px;overflow:hidden;text-overflow:ellipsis;transition:width .3s ease}@media(pointer: fine){.bc-call-info .info .name:hover{width:400px}}',""]);const c=a},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,r,o){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(i)for(var c=0;c<this.length;c++){var l=this[c][0];null!=l&&(a[l]=!0)}for(var s=0;s<t.length;s++){var d=[].concat(t[s]);i&&a[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),e.push(d))}},e}},81:t=>{t.exports=function(t){return t[1]}},187:t=>{var e,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var r=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,t.exports.once=function(t,e){return new Promise((function(n,i){function r(n){t.removeListener(e,o),i(n)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",r),n([].slice.call(arguments))}h(t,e,o,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&h(t,"error",e,{once:!0})}(t,r)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function c(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function s(t,e,n,i){var r,o,a,s;if(c(n),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]),void 0===a)a=o[e]=n,++t._eventsCount;else if("function"==typeof a?a=o[e]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(r=l(t))>0&&a.length>r&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=t,d.type=e,d.count=a.length,s=d,console&&console.warn&&console.warn(s)}return t}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=d.bind(i);return r.listener=n,i.wrapFn=r,r}function f(t,e,n){var i=t._events;if(void 0===i)return[];var r=i[e];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(r):p(r,r.length)}function v(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function h(t,e,n,i){if("function"==typeof t.on)i.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function r(o){i.once&&t.removeEventListener(e,r),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t||t<0||r(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");a=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||r(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var l=o[t];if(void 0===l)return!1;if("function"==typeof l)i(l,this,e);else{var s=l.length,d=p(l,s);for(n=0;n<s;++n)i(d[n],this,e)}return!0},o.prototype.addListener=function(t,e){return s(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return s(this,t,e,!0)},o.prototype.once=function(t,e){return c(e),this.on(t,u(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return c(e),this.prependListener(t,u(this,t,e)),this},o.prototype.removeListener=function(t,e){var n,i,r,o,a;if(c(e),void 0===(i=this._events))return this;if(void 0===(n=i[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){a=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,r),1===n.length&&(i[t]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",t,a||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},o.prototype.listeners=function(t){return f(this,t,!0)},o.prototype.rawListeners=function(t){return f(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):v.call(t,e)},o.prototype.listenerCount=v,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},379:t=>{var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var o={},a=[],c=0;c<t.length;c++){var l=t[c],s=i.base?l[0]+i.base:l[0],d=o[s]||0,u="".concat(s," ").concat(d);o[s]=d+1;var f=n(u),v={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)e[f].references++,e[f].updater(v);else{var p=r(v,i);i.byIndex=c,e.splice(c,0,{identifier:u,updater:p,references:1})}a.push(u)}return a}function r(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,r){var o=i(t=t||[],r=r||{});return function(t){t=t||[];for(var a=0;a<o.length;a++){var c=n(o[a]);e[c].references--}for(var l=i(t,r),s=0;s<o.length;s++){var d=n(o[s]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}o=l}}},569:t=>{var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={id:i,exports:{}};return t[i](o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nc=void 0;var i={};return(()=>{n.r(i),n.d(i,{default:()=>S});var t=n(187),e=n(379),r=n.n(e),o=n(795),a=n.n(o),c=n(569),l=n.n(c),s=n(565),d=n.n(s),u=n(216),f=n.n(u),v=n(589),p=n.n(v),h=n(326),m={};function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function y(){y=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var r=e&&e.prototype instanceof u?e:u,o=Object.create(r.prototype),a=new E(i||[]);return o._invoke=function(t,e,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return{value:void 0,done:!0}}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var c=L(a,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=s(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),o}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function u(){}function f(){}function v(){}var p={};c(p,r,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(I([])));m&&m!==e&&n.call(m,r)&&(p=m);var g=v.prototype=u.prototype=Object.create(p);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function i(r,o,a,c){var l=s(t[r],t,o);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==b(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,a,c)}),(function(t){i("throw",t,a,c)})):e.resolve(u).then((function(t){d.value=t,a(d)}),(function(t){return i("throw",t,a,c)}))}c(l.arg)}var r;this._invoke=function(t,n){function o(){return new e((function(e,r){i(t,n,e,r)}))}return r=r?r.then(o,o):o()}}function L(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,L(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=s(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var r=i.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:j}}function j(){return{value:void 0,done:!0}}return f.prototype=v,c(g,"constructor",v),c(v,"constructor",f),f.displayName=c(v,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},w(x.prototype),c(x.prototype,o,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new x(l(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(g),c(g,a,"Generator"),c(g,r,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=I,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;k(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:I(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function w(t,e,n,i,r,o,a){try{var c=t[o](a),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(i,r)}function x(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function a(t){w(o,i,r,a,c,"next",t)}function c(t){w(o,i,r,a,c,"throw",t)}a(void 0)}))}}function L(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function C(t,e){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},C(t,e)}function k(t,e){if(e&&("object"===b(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return E(t)}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function I(t){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},I(t)}function j(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}m.styleTagTransform=p(),m.setAttributes=d(),m.insert=l().bind(null,"head"),m.domAPI=a(),m.insertStyleElement=f(),r()(h.Z,m),h.Z&&h.Z.locals&&h.Z.locals;var T=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&C(t,e)}(a,t);var e,n,i,r,o=(i=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=I(i);if(r){var n=I(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return k(this,t)});function a(t,e,n,i){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),j(E(r=o.call(this)),"controls",null),j(E(r),"isFrontalCamera",!1),j(E(r),"videoStreams",null),j(E(r),"isMuted",!1),j(E(r),"activeCall",null),j(E(r),"secondCall",null),j(E(r),"syncInterval",null),j(E(r),"isWaitingForConnect",!1),j(E(r),"signal",null),j(E(r),"timer",null),j(E(r),"timeInterval",null),j(E(r),"title",null),j(E(r),"templates",{incomingCall:function(){return'\n\t\t\t<div class="bc-incoming-call">\n\t\t\t\t<div class="user">\n\t\t\t\t\t<div class="avatar">\n\t\t\t\t\t\t'.concat(this.getAvatar(),'\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="title">\n\t\t\t\t\t\t<div class="name">').concat(this.activeCall.initiator.source.name,'</div>\n\t\t\t\t\t\t<div class="description">').concat(this.options.getWithLocale("incomingCall"),'</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="buttons">\n\t\t\t\t\t<button class="bc-btn bc-decline" id="bc-decline"><i class="fas fa-phone"></i></button>\n\t\t\t\t\t<button class="bc-btn bc-answer" id="bc-answer"><i class="fas fa-phone"></i></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t')},endedCall:function(t){return'\t\n\t\t\t<div class="bc-ended-call">\n\t\t\t\t<div class="avatar">\n\t\t\t\t\t\t'.concat(this.getAvatar(),'\n\t\t\t\t</div>\n\t\t\t\t<div class="name">').concat(this.activeCall.initiator.source.name,'</div>\n\t\t\t\t<div class="description">').concat(this.options.getWithLocale("endedCall"),"</div>\n\t\t\t</div>")},videoCall:function(){return'\n\t\t\t<div class="bc-topnav">\n\t\t\t\t<div class="bc-call-info">\n\t\t\t\t\t<div class="avatar">\n\t\t\t\t\t\t'.concat(this.getAvatar(),'\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="info">\n\t\t\t\t\t\t<div class="name">').concat(this.activeCall.initiator.source.name,'</div>\n\t\t\t\t\t\t<div class="time" id="time">0:00</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="options">\n\t\t\t\t\t<button class="bc-btn bc-cog" id="bc-cog"><i class="fas fa-cog"></i></button>\n\t\t\t\t\t<button class="bc-btn bc-pip" id="bc-pip"><i class="fas fa-minus"></i></button>\n\t\t\t\t\t<button class="bc-btn bc-format" id="bc-format"><i class="fas"></i></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bc-video-container">\n\t\t\t\t<div class="bc-video active novid" id="remote-scene">\n\t\t\t\t\t<video id="remote" pip="false" autoplay playsinline ></video>\n\t\t\t\t\t<div class="avatar">').concat(this.getAvatar(),'</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bc-video minified">\n\t\t\t\t\t<video id="local" pip="false" autoplay playsinline ></video>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bc-controls">\n\t\t\t\t<button class="bc-btn bc-camera" id="bc-camera"><i class="fas fa-sync-alt"></i></button>\n\t\t\t\t<button class="bc-btn bc-hide" id="bc-hide"><i class="fas fa-video"></i></button>\n\t\t\t\t<button class="bc-btn bc-mute" id="bc-mute"><i class="fas fa-microphone"></i></button>\n\t\t\t\t<button class="bc-btn bc-decline" id="bc-decline"><i class="fas fa-phone"></i></button>\n\t\t\t\t<button class="bc-btn bc-expand" id="bc-expand"><i class="fas fa-expand"></i></button>\n\t\t\t</div>\n\t\t')}}),j(E(r),"renderTemplates",{videoCall:function(){var t;r.root.classList.add("middle"),r.root.innerHTML=(null===(t=r.templates.videoCall)||void 0===t?void 0:t.call(E(r)))||"",r.initCallInterface("videoCall")},incomingCall:function(t){var e;r.notify.innerHTML=(null===(e=r.templates.incomingCall)||void 0===e?void 0:e.call(E(r)))||"",r.initCallInterface("incomingCall",t)},clearNotify:function(){r.notify.innerHTML=""},clearVideo:function(){r.root.innerHTML=""},clearInterface:function(){r.root.classList.remove("active"),r.root.classList.remove("minified"),r.root.classList.remove("middle"),r.root.classList.remove("full")},endedCall:function(t){var e;r.root.classList.contains("minified")&&(r.root.classList.remove("minified"),r.root.classList.add("middle")),r.root.innerHTML=(null===(e=r.templates.endedCall)||void 0===e?void 0:e.call(E(r),t))||""}}),r.client=t,r.matrixcs=e,r.initEvents(),r.initSignals(),r.initTemplates(n),r.initCordovaPermisions(),r.options=i,r}return e=a,n=[{key:"initTemplates",value:function(t){var e=this;t.insertAdjacentHTML("beforeend",'<div class="bc-container"><div id="bc-notify" class="bc-notify"></div><div id="bc-root"></div></div>'),this.root=document.getElementById("bc-root"),this.notify=document.getElementById("bc-notify"),window&&(window.onunload=function(){e.activeCall&&e.activeCall.hangup()})}},{key:"initEvents",value:function(){var t=this;this.client.on("Call.incoming",function(){var e=x(y().mark((function e(n){var i,r,o,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("incoming call"),t.title=document.querySelector("title").innerHTML,document.querySelector("title").innerHTML=t.options.getWithLocale("incomingCall"),t.emit("initcall"),i=t.client.store.rooms[n.roomId].currentState.members,r=Object.keys(i).filter((function(e){return e!==t.client.credentials.userId})),o=i[r],a=i[t.client.credentials.userId],n.initiator=o,n.user=a,t.options.getUserInfo(o.userId).then((function(e){if(!n.hangupParty&&!n.hangupReason){o.source=e[0]||e,t.addCallListeners(n),t.activeCall?t.secondCall?(n.hangup("busy"),n.reject("busy")):t.secondCall=n:t.activeCall=n;var i=new Audio("js/lib");i.autoplay=!0,i.loop=!0,t.signal=i,t.renderTemplates.incomingCall(n),t.signal.src="sounds/incoming.mp3"}}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"initSignals",value:function(){this.signal=new Audio}},{key:"clearTimer",value:function(){this.timer=null,clearInterval(this.timeInterval),this.timeInterval=null}},{key:"initTimer",value:function(){this.timer=0;var t=document.getElementById("time");this.timeInterval=setInterval(function(){this.timer++;var e=Math.floor(this.timer/60),n=this.timer%60;t.innerHTML="".concat(e,":").concat(n>=10?n:"0"+n)}.bind(this),1e3)}},{key:"answer",value:function(){var t=this;console.log("state on answer",this.activeCall.state);try{console.log(),"connected"!==this.activeCall.state||"ended"!==this.activeCall.state?(this.activeCall.answer(),console.log("Ответ на",this.activeCall),this.signal.pause(),this.renderTemplates.clearNotify(),this.renderTemplates.videoCall()):(this.isWaitingForConnect=!0,this.renderTemplates.clearNotify(),this.activeCall.hangup(),setTimeout((function(){try{console.log("Сброс + ответ на",t.activeCall),t.activeCall.answer(),t.signal.pause(),t.isWaitingForConnect=!1,t.renderTemplates.videoCall()}catch(e){console.error("Ошибка при ответе на вторую линию",e),t.signal.pause()}}),1e3))}catch(t){console.error("error answer",t),this.signal.pause()}}},{key:"initsync",value:function(){var t=document.querySelector(".bc-video-container");this.activeCall.peerConn.getStats(null).then((function(t){var e;(e=t,function(t){if(Array.isArray(t))return g(t)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).filter((function(t){return"candidate-pair"===t[1].type})).forEach((function(t){}))})),this.syncInterval=setInterval(function(){var e;if(null!=this&&null!==(e=this.activeCall)&&void 0!==e&&e.remoteStream){var n,i=null==this||null===(n=this.activeCall)||void 0===n?void 0:n.remoteStream.getVideoTracks()[0];if(this.root.classList.contains("minified")){var r=i.getSettings().aspectRatio;r&&(t.style.aspectRatio=r,r<1?t.classList.add("vertical"):t.classList.remove("vertical"))}}}.bind(this),1e3)}},{key:"mute",value:function(t){t.stopPropagation();var e=this.activeCall.peerConn.getSenders().find((function(t){return"audio"===t.track.kind})),n=document.querySelector(".bc-mute");e.track.enabled?(n.firstChild.classList.remove("fa-microphone"),n.classList.add("active"),n.firstChild.classList.add("fa-microphone-slash")):(n.firstChild.classList.remove("fa-microphone-slash"),n.classList.remove("active"),n.firstChild.classList.add("fa-microphone")),e.track.enabled=!e.track.enabled}},{key:"hide",value:function(t){t.stopPropagation();var e=this.activeCall.peerConn.getSenders().find((function(t){var e;return"video"===(null===(e=t.track)||void 0===e?void 0:e.kind)||!t.track})),n=document.querySelector(".bc-hide");e.track.enabled?(n.firstChild.classList.remove("fa-video"),n.classList.add("active"),n.firstChild.classList.add("fa-video-slash")):(n.firstChild.classList.remove("fa-video-slash"),n.classList.remove("active"),n.firstChild.classList.add("fa-video")),e.track.enabled=!e.track.enabled}},{key:"cameraCount",value:function(){navigator.mediaDevices.enumerateDevices().then((function(t){var e=t.filter((function(t){return"videoinput"===t.kind}));e.length<=1&&(document.getElementById("bc-camera").style.display="none",console.log("no cameras",e))}))}},{key:"camera",value:function(t){var e=this,n=this;try{navigator.mediaDevices.enumerateDevices().then((function(t){var i,r,o=t.filter((function(t){return"videoinput"===t.kind})),a=n.activeCall.peerConn.getSenders().find((function(t){return"video"===t.track.kind}));if(a&&null!=a&&null!==(i=a.label)&&void 0!==i&&i.includes("front")&&(n.isFrontalCamera=!0),console.log("video list",o),o.length>1){a.track.label.includes("front")||a.track.label.includes("передней")?(console.log("to back"),r=o.reverse().find((function(t){return t.label.includes("back")||t.label.includes("задней")}))):(console.log("to front"),r=o.find((function(t){return t.label.includes("front")||t.label.includes("передней")})));var c={};c.deviceId={exact:r.deviceId};var l={video:c,audio:!1};navigator.mediaDevices.getUserMedia(l).then((function(t){t.getTracks().forEach((function(e){var i=n.activeCall.peerConn.getSenders().find((function(t){return t.track.kind==e.kind}));i.track.label!==e.label?(e.muted,i.replaceTrack(e),n.videoStreams.local.srcObject=t):console.log("same streams on change")})),e.hide()})).catch((function(t){console.log("Const stream: "+t.message)}))}})).catch((function(t){}))}catch(t){}}},{key:"format",value:function(){this.root.classList.contains("middle")?(this.root.classList.remove("middle"),this.root.classList.add("full")):this.root.classList.contains("full")&&(this.root.classList.remove("full"),this.root.classList.add("middle"))}},{key:"pip",value:function(){this.root.classList.contains("middle")?(this.root.classList.remove("middle"),this.root.classList.add("minified")):this.root.classList.contains("full")?(this.root.classList.remove("full"),this.root.classList.add("minified")):(clearInterval(this.syncInterval),this.root.classList.remove("minified"),this.root.classList.add("middle"))}},{key:"initCall",value:function(t){var e,n;if((null==this||null===(e=this.activeCall)||void 0===e?void 0:e.roomId)===t)return console.log("only one call in room"),void("ringing"===(null==this||null===(n=this.activeCall)||void 0===n?void 0:n.state)&&(console.log("answer to incoming from same room"),this.answer()));this.emit("initcall");var i=matrixcs.createNewMatrixCall(this.client,t);if(i.placeVideoCall(document.getElementById("remote"),document.getElementById("local")).then(x(y().mark((function t(){var e,n,r,o,a=this;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.client.store.rooms[i.roomId].currentState.members,n=Object.keys(e).filter((function(t){return t!==a.client.credentials.userId})),r=e[n],o=e[this.client.credentials.userId],i.initiator=r,i.user=o,t.next=8,this.options.getUserInfo(r.userId)[0];case 8:r.source=t.sent,this.options.getUserInfo(r.userId).then((function(t){r.source=t[0]||t,a.signal.src="sounds/calling.mp3",a.renderTemplates.videoCall()})).catch((function(t){return console.log("get user info error",t)}));case 10:case"end":return t.stop()}}),t,this)}))).bind(this)),this.addCallListeners(i),!this.activeCall){this.activeCall=i;var r=new Audio("js/lib");return r.autoplay=!0,r.loop=!0,this.signal=r,i}}},{key:"hexDecode",value:function(t){for(var e=0,n="",i=2;i<=t.length;i+=2)(e=parseInt(t.substring(i-2,i),16))>=128&&(e+=848),n+=e=String.fromCharCode("0x"+e.toString(16));return n}},{key:"hangup",value:function(t){t.stopPropagation(),this.activeCall.hangup("ended",!1),this.renderTemplates.clearVideo(),this.signal.pause()}},{key:"reject",value:function(t){t.reject("busy"),this.signal.pause()}},{key:"initCallInterface",value:function(t,e){var n=this;switch(t){case"incomingCall":document.getElementById("bc-answer").addEventListener("click",this.answer.bind(this)),document.getElementById("bc-decline").addEventListener("click",(function(){return n.reject(e)}));break;case"videoCall":this.videoStreams={remote:document.getElementById("remote"),local:document.getElementById("local")};try{this.activeCall.setLocalVideoElement(this.videoStreams.local),this.activeCall.setRemoteVideoElement(this.videoStreams.remote),this.cameraCount(),this.addVideoInterfaceListeners()}catch(t){}}}},{key:"addVideoInterfaceListeners",value:function(){var t=this;document.getElementById("remote-scene").addEventListener("click",(function(e){return t.pip.call(t,e)})),document.getElementById("bc-decline").addEventListener("click",(function(e){return t.hangup.call(t,e)})),document.getElementById("bc-mute").addEventListener("click",(function(e){return t.mute.call(t,e)})),document.getElementById("bc-hide").addEventListener("click",(function(e){return t.hide.call(t,e)})),document.getElementById("bc-camera").addEventListener("click",(function(e){return t.camera.call(t,e)})),document.getElementById("bc-expand").addEventListener("click",(function(e){return t.pip.call(t,e)})),document.getElementById("bc-cog").addEventListener("click",(function(e){return t.settings.call(t,e)})),document.getElementById("bc-format").addEventListener("click",(function(e){return t.format.call(t,e)})),document.getElementById("bc-pip").addEventListener("click",(function(e){return t.pip.call(t,e)}))}},{key:"addCallListeners",value:function(t){var e=this;t.on("state",(function(n,i){console.log("state",n,t),"connected"===n&&(e.showRemoteVideo(),e.timeInterval||e.initTimer(),e.signal.pause(),document.querySelector("title").innerHTML=e.title,e.initsync()),"ended"===n&&(e.clearTimer(),clearInterval(e.syncInterval),e.syncInterval=null,e.signal.pause(),document.querySelector("title").innerHTML=e.title)})),t.on("hangup",(function(t){var n,i;if(console.log("hangup",t),clearInterval(e.syncInterval),e.syncInterval=null,t||e.renderTemplates.clearNotify(),t.callId===(null===(n=e.secondCall)||void 0===n?void 0:n.callId)&&(e.secondCall=null,e.renderTemplates.clearNotify()),t.callId===(null===(i=e.activeCall)||void 0===i?void 0:i.callId)){if(e.isWaitingForConnect)return e.activeCall=e.secondCall,void(e.secondCall=null);if(e.renderTemplates.clearVideo(),e.renderTemplates.clearNotify(),"local"===t.hangupParty||t.localVideoElement)return e.root.classList.contains("minified")||!e.root.classList.length?(e.renderTemplates.clearVideo(),e.renderTemplates.clearInterface(),void(e.activeCall=null)):(e.renderTemplates.endedCall(t),"user_hangup"!==t.hangupReason||t.remoteStream||"local"===t.hangupParty||(e.signal.loop=!1,e.signal.src="sounds/busy.mp3"),void setTimeout((function(){e.renderTemplates.clearVideo(),e.renderTemplates.clearInterface(),e.activeCall=null}),3e3));e.signal.pause(),e.renderTemplates.clearInterface()}})),t.on("replaced",(function(t){console.log("replaced",t),console.log("old",e.activeCall),e.activeCall=null,e.signal.pause();var n=e.client.store.rooms[t.roomId].currentState.members,i=n[Object.keys(n).filter((function(t){return t!==e.client.credentials.userId}))],r=n[e.client.credentials.userId];t.initiator=i,t.user=r,e.options.getUserInfo(i.userId).then((function(n){t.hangupParty||t.hangupReason||(i.source=n[0]||n,e.addCallListeners(t),console.log("listen added",e,t),e.activeCall?e.secondCall?(console.log("all lines"),t.hangup("busy"),t.reject("busy")):(e.secondCall=t,console.log("now second",e.secondCall)):(e.activeCall=t,console.log("now active",e.activeCall)),"wait_local_media"===t.state?(console.log("wait media!"),setTimeout(function(){this.answer()}.bind(e),1e3)):(e.answer(),e.showRemoteVideo()))}))})),t.on("error",(function(n){console.error("some error",n,e),t.hangup("error"),e.signal.pause(),e.renderTemplates.clearVideo(),e.emit("error",n)}))}},{key:"getAvatar",value:function(){var t,e;return null!==(t=this.activeCall.initiator)&&void 0!==t&&null!==(e=t.source)&&void 0!==e&&e.image?'<img src="'.concat(this.activeCall.initiator.source.image,'"/>'):this.activeCall.initiator.source.name[0].toUpperCase()}},{key:"showRemoteVideo",value:function(){document.getElementById("remote-scene").classList.remove("novid")}},{key:"initCordovaPermisions",value:function(){var t;if(null!==(t=window)&&void 0!==t&&t.cordova){var e=cordova.plugins.permissions,n=[e.CAMERA,e.RECORD_AUDIO];e.requestPermissions(n,(function(){console.log("camera is turned on")}),(function(){console.log("Camera permission is not turned on")}))}}}],n&&L(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(t.EventEmitter);window.BastyonCalls=T;const S=T})(),i})()));